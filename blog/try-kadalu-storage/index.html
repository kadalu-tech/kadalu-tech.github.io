

<!DOCTYPE HTML>
<html lang="en">
    <head>
    <meta name="viewport" content="width=device-width"/>
    <meta charSet="utf-8"/>
    <title>Try Kadalu Storage!</title>
    <link rel="stylesheet" href="/bulma-0.9.4.min.css">
    <link rel="stylesheet" href="/stylesheet.css">
    <link rel="stylesheet" href="/syntax-highlight-emacs.css">
    <script defer src="/alpinejs-3.10.5.min.js"></script>

    <meta name="generator" content="Nanoc 4.12.7">
    
<link href="/static/css/fav.png" rel="icon" type="image/x-icon" />
<link rel="apple-touch-icon" href="/static/css/fav.png" />
<meta name="generator" content="Nanoc 4.12.7">
<meta property="og:title" content="Try Kadalu Storage!"/>
<meta name="author" content="aravindavk"/>
<meta property="og:locale" content="en_US"/>
<meta name="description" content="If you have a few spare VMs or machines, then you can easily set up Kadalu Storage and check  if it fits your needs. Kadalu Storage team has created ready to use containers that can be started to behave as Storage nodes."/>
<meta property="og:description" content="If you have a few spare VMs or machines, then you can easily set up Kadalu Storage and check  if it fits your needs. Kadalu Storage team has created ready to use containers that can be started to behave as Storage nodes."/>
<link rel="canonical" href="/blog/try-kadalu-storage/"/>
<meta property="og:url" content="/blog/try-kadalu-storage/"/>
<meta property="og:site_name" content="Kadalu"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2022-07-22"/>

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://kadalu.tech/images/kadalu-storage-intro.png"/>
<meta property="og:image" content="https://kadalu.tech/images/kadalu-storage-intro.png"/>

<meta name="twitter:site" content="https://kadalu.tech"/>
<meta name="twitter:title" content="Try Kadalu Storage!"/>
<meta name="twitter:description" content="If you have a few spare VMs or machines, then you can easily set up Kadalu Storage and check  if it fits your needs. Kadalu Storage team has created ready to use containers that can be started to behave as Storage nodes."/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />


    <script defer data-domain="kadalu.tech" src="https://plausible.io/js/plausible.js"></script>
</head>

    <body>
        <div id="main">
            <nav class="navbar px-4" role="navigation" aria-label="main navigation" x-data="{showing: false}">
  <div class="navbar-brand has-text-left">
      <a class="navbar-item" href="/">
          <img src="/images/logo.svg" alt="Kadalu Technologies" width="300">
    </a>

    <a role="button" class="navbar-burger" aria-label="menu" :class="showing ? 'is-active' : ''" aria-expanded="false" @click="showing = !showing">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>

  <div class="navbar-end" x-show="showing">
      <a class="navbar-item" href="/blog">
          Blog
      </a>
      <a class="navbar-item" href="/about">
          About Us
      </a>
  </div>
  <div class="navbar-end is-hidden-touch">
      <a class="navbar-item" href="/blog">
          Blog
      </a>
      <a class="navbar-item" href="/about">
          About Us
      </a>
  </div>
</nav>

            <div class="container is-max-desktop px-4" id="content">
                <div class="has-text-centered py-6">
                    <a href="/">
                        <figure class="image is-64x64" style="margin: auto">
                            <img class="is-rounded" src="https://github.com/aravindavk.png?size=300px">
                        </figure>
                        <p class="has-text-grey pb-6 is-size-6 is-uppercase">Aravinda Vishwanathapura</p>
                    </a>
                </div>

                <div class="">
                    <h1 class="title is-1 has-text-centered">Try Kadalu Storage!</h1>
                    <div class="has-text-grey mb-1 has-text-centered">
                        Posted on <strong>Jul 22, 2022</strong> by <strong>Aravinda Vishwanathapura</strong>
                    </div>
                    <p class="has-text-centered">
                        <svg class="mr-1 icon is-inline-block" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path></svg>
                        4 minutes read.
                    </p>
                    <div class="content py-6">
                        <div class="paragraph">
<p>Kadalu Storage is an opinionated distributed Storage solution based on GlusterFS. Kadalu Storage uses the file system layer from GlusterFS and built a completely new ecosystem around it.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/kadalu-storage-intro.png" alt="Kadalu Storage">
</div>
</div>
<div class="paragraph">
<p>In this blog post, We will discuss Kadalu Storage and try it out using containers. Native packages for Ubuntu/Fedora/CentOS distributions are coming soon.</p>
</div>
<div class="sect1">
<h2 id="_one_storage_container_per_vmnode_production_setup">One Storage container per VM/node (Production setup)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have a few spare VMs or machines, then you can easily set up Kadalu Storage and check  if it fits your needs. Kadalu Storage team has created ready to use containers that can be started to behave as Storage nodes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo docker run -d                            \
    --network host                            \
    -v /root/kadalu/workdir:/var/lib/kadalu   \
    -v /root/kadalu/config:/root/.kadalu      \
    -v /ZP1/storage1:/ZP/storage1             \
    -v /sys/fs/cgroup/:/sys/fs/cgroup:ro      \
    --privileged                              \
    --name kadalu-$(hostname)                 \
    --hostname $(hostname)                    \
    kadalu/storage-node:latest</pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the following Storage is exposed to the Storage container as a Volume.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>-v /ZP1/storage1:/ZP/storage1</pre>
</div>
</div>
<div class="paragraph">
<p>Pre-create the file system(xfs/ext4/zfs) and expose the Storage while starting the Kadalu Storage container. Provide multiple Storage units per container/node as required. For example, the following code shows creating ZFS dataset and exposing that while starting the Storage node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo zpool create ZP1 /dev/vda
sudo zfs create ZP1/storage1</pre>
</div>
</div>
<div class="paragraph">
<p>Along with Storage units a few other directories have to be persisted.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/var/lib/kadalu</code> - If a Container becomes Mgr instance then it stores full cluster configurations, else if it is Agent instance, it will contain the tokens that are required to communicate with Mgr instances.</p>
</li>
<li>
<p><code>/root/.kadalu</code> - This is optional, but good to have this persisted to avoid running login command every time on container restart.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With <code>network=host</code> option, starting multiple Storage containers per node is not possible with this option. Instead, expose multiple Storage units per instance of Storage container.</p>
</div>
<div class="paragraph">
<p>A utility script, provided in the project repo, that helps to spawn the Storage containers. For example, the following code shows starting three Storage containers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">server1 $</span><span class="w"> </span>python3 start_storage_node_container.py <span class="nt">-w</span> /root/kadalu /ZP1/storage /ZP2/storage
<span class="gp">server2 $</span><span class="w"> </span>python3 start_storage_node_container.py <span class="nt">-w</span> /root/kadalu /ZP3/storage /ZP4/storage
<span class="gp">server3 $</span><span class="w"> </span>python3 start_storage_node_container.py <span class="nt">-w</span> /root/kadalu /ZP5/storage /ZP6/storage
<span class="gp">client1 $</span><span class="w"> </span>python3 start_storage_node_container.py <span class="nt">-w</span> /root/kadalu</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multiple_storage_containers_per_vmnode_development_setup">Multiple Storage containers per VM/node (Development Setup)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to experience the multi node Kadalu Storage using single VM/node, create a network and use the same while creating a Kadalu Storage container.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo docker network create k1

sudo docker run -d                            \
    --network k1                              \
    -v /root/kadalu/workdir1:/var/lib/kadalu  \
    -v /root/kadalu/config1:/root/.kadalu     \
    -v /exports/s1:/exports/s1                \
    -v /sys/fs/cgroup/:/sys/fs/cgroup:ro      \
    --privileged                              \
    --name kadalu-server1                     \
    --hostname server1                        \
    kadalu/storage-node:latest</pre>
</div>
</div>
<div class="paragraph">
<p>Note the change in <code>--network</code> option compared to the previous method. Use the utility script to automatically create the network and start multiple Storage/client containers in single node/VM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">testvm $</span><span class="w"> </span><span class="nb">mkdir</span> <span class="nt">-p</span> /exports/s1 /exports/s2 /exports/s3
<span class="gp">testvm $</span><span class="w"> </span>python3 start_storage_node_container.py <span class="nt">-w</span> /root/kadalu1 /exports/s1 <span class="nt">--network</span> k1 <span class="nt">--hostname</span> server1
<span class="gp">testvm $</span><span class="w"> </span>python3 start_storage_node_container.py <span class="nt">-w</span> /root/kadalu2 /exports/s2 <span class="nt">--network</span> k1 <span class="nt">--hostname</span> server2
<span class="gp">testvm $</span><span class="w"> </span>python3 start_storage_node_container.py <span class="nt">-w</span> /root/kadalu3 /exports/s3 <span class="nt">--network</span> k1 <span class="nt">--hostname</span> server3
<span class="gp">testvm $</span><span class="w"> </span>python3 start_storage_node_container.py <span class="nt">-w</span> /root/kadalu4 <span class="nt">--network</span> k1 <span class="nt">--hostname</span> client</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once all the required containers (Storage nodes) are running, then create a Pool and the Volume.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>docker <span class="nb">exec</span> <span class="nt">-it</span> kadalu-server1 /bin/bash
<span class="gp">#</span><span class="w"> </span>kadalu user create admin
<span class="go">Password:
User admin created successfully. Run `kadalu user login admin` to login
</span><span class="gp">#</span><span class="w"> </span>kadalu user login admin
<span class="go">Password:
Login successful. Details saved in `/root/.kadalu/session`. Delete this file or run `kadalu user logout` command to delete the session.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a Kadalu Volume using the Storage exported from the host.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>server1 # kadalu volume create DEV/vol1 --auto-create-pool --auto-add-nodes \
    mirror server1:/ZP1/storage/vol1                                        \
           server2:/ZP3/storage/vol1                                        \
           server3:/ZP5/storage/vol1</pre>
</div>
</div>
<div class="paragraph">
<p>Mount the Volume by logging into one of the Storage container or the Client container.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>docker <span class="nb">exec</span> <span class="nt">-it</span> kadalu-client1 /bin/bash
<span class="gp">#</span><span class="w"> </span>kadalu login admin
<span class="go">Password:
</span><span class="gp">#</span><span class="w"> </span><span class="nb">mkdir</span> /mnt/vol1
<span class="gp">#</span><span class="w"> </span>mount <span class="nt">-t</span> kadalu server1:/DEV/vol1 /mnt/vol1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Workdir and Storage are persisted even after Container restart. Stop the containers, and delete those directories if complete cleanup is required.</p>
</div>
<div class="paragraph">
<p>Kadalu Storage is still under development, Please provide your valuable feedback (<a href="https://github.com/kadalu/moana/issues" class="bare">https://github.com/kadalu/moana/issues</a>) to make Kadalu Storage production ready for you!</p>
</div>
</div>
</div>
                    </div>
                </div>

                <div class="has-text-centered mb-6 notification is-light">
                    <p class="has-text-grey is-uppercase is-size-5 pb-2">About Aravinda Vishwanathapura</p>
                    
                    <p>Co-Founder, CTO - Kadalu Technologies</p>
                    
                    <p>
                        
                        <a class="mr-2" href="https://aravindavk.in">Website</a>|
                        
                        
                        <a class="mx-2" href="https://twitter.com/aravindavk">Twitter</a>|
                        
                        <a class="ml-2" href="https://github.com/aravindavk">Github</a>
                    </p>
                </div>
            </div>

        </div>
        <div class="footer has-background-primary has-text-white mt-6">
    <div class="columns">
        <div class="column">
            <h2 class="has-font-weight-semibold is-size-5 is-underlined py-2">Company</h2>
            <a class="is-block has-text-white" href="/about">About Us</a>
            <a class="is-block has-text-white" href="/blog">Blog Posts</a>
        </div>
        <div class="column">
            <h2 class="has-font-weight-semibold is-size-5 is-underlined py-2">Resources</h2>
            <a class="is-block has-text-white" href="/support">Support</a>
            <a class="is-block has-text-white" href="/security">Security</a>
            <a class="is-block has-text-white" href="/gluster-vs-kadalu">Gluster vs Kadalu</a>
            <a class="is-block has-text-white" href="/storage/quick-start">Kadalu Storage Quick start</a>
        </div>
        <div class="column">
            <h2 class="has-font-weight-semibold is-size-5 is-underlined py-2">Community</h2>
            <a class="is-block has-text-white" target="_blank" href="https://join.slack.com/t/kadalu/shared_invite/enQtNzg1ODQ0MDA5NTM2LWMzMTc5ZTJmMjk4MzI0YWVhOGFlZTJjZjY5MDNkZWI0Y2VjMDBlNzVkZmI1NWViN2U3MDNlNDJhNjE5OTBlOGU">Community Slack</a>
            <a class="is-block has-text-white" target="_blank" href="https://github.com/kadalu">Github</a>
        </div>

        <div class="column">
            <h2 class="has-font-weight-semibold is-size-5 is-underlined py-2">Contact Us</h2>
            <a class="is-block has-text-white" href="mailto:hello@kadalu.tech">Email to hello@kadalu.tech</a>
            <a class="is-block has-text-white" href="https://twitter.com/kadalu_tech">Twitter</a>
            <a class="is-block has-text-white" href="https://linkedin.com/kadalu_tech">Linkedin</a>
        </div>
    </div>
    <div class="has-text-centered mt-6">
        Copyright &copy; 2022 Kadalu Technologies Private Limited.
    </div>
</div>

        </div>
    </body>
</html>
